<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pagamento Cr√©dito</title>
  <link rel="stylesheet" href="./css/styleC.css">
</head>

<body>

<header>
  <h1>üí≥ Pagamento Cr√©dito</h1>
  <p>üöö Devolu√ß√£o gratuita</p>
  <button onclick="window.location.href='carrinho.html'">Voltar</button>
</header>

<br>

<div class="bandeiras">
  <img src="./pagamentos/cartoes banner.jpg" alt="Mastercard">
  <img src="./images/Elo.webp" alt="Elo">
  <img src="./images/American_Express.svg" alt="Amex">
</div>

<br><br>

<div class="total">
  <h3>Total: <span id="total-compra">R$0,00</span></h3>
</div>

<div class="Valor-Final">
  <h3>Com Juros: <span id="totalValor">R$0,00</span></h3>
</div>

<form class="form-pagamento" onsubmit="PedidoFeito(event)">

  <label>N√∫mero do Cart√£o</label>
  <input type="text" placeholder="üí≥ 0000 0000 0000 0000" maxlength="16" required>

  <div class="linha">
      <div>
        <label>Validade</label>
        <input type="month" required>
      </div>

      <div>
        <label>CVV</label>
        <input type="text" placeholder="3-4 d√≠gitos" maxlength="4" required>
      </div>
  </div>

  <div class="formulario-container">
    <h4>Parcelamento</h4>

    <select id="parcelas" required>
        <option value="">Selecione...</option>
        <option value="1">1x no cart√£o - √Ä vista</option>
        <option value="2">2x sem juros</option>
        <option value="3">3x sem juros</option>
        <option value="4">4x sem juros</option>
        <option value="5">5x sem juros</option>
        <option value="6">6x sem juros</option>
        <option value="7">7x com juros</option>
        <option value="8">8x com juros</option>
        <option value="9">9x com juros</option>
        <option value="10">10x com juros</option>
        <option value="12">12x com juros</option>
    </select>
  </div>

  <button type="button" onclick="enviarWhatsapp()">Enviar pedido no WhatsApp</button>

  <button type="submit">Concluir Pagamento</button>
</form>

<script>
  
// ======== BOT√ÉO WHATSAPP =========
function enviarWhatsapp() {
  let numero = "5519988943311";

  let totalSemJuros = localStorage.getItem("carrinho_total") || "0.00";
  let totalComJuros = localStorage.getItem("totalFinal") || totalSemJuros;
  let parcelas = document.getElementById("parcelas").value || "1";

  let mensagem = `üì¶ *NOVO PEDIDO*

üßæ Total sem juros: R$ ${parseFloat(totalSemJuros).toFixed(2)}
üí∞ Total com juros: R$ ${parseFloat(totalComJuros).toFixed(2)}
üìå Parcelamento: ${parcelas}x
üí≥ Forma de pagamento: Cart√£o de Cr√©dito
üìÖ Data: ${new Date().toLocaleString()}

Por favor, preparar o pedido.`;

  let url = "https://wa.me/" + numero + "?text=" + encodeURIComponent(mensagem);
  window.open(url, "_blank");
}

// ========= FINALIZAR PAGAMENTO =========
async function PedidoFeito(event) {
  event.preventDefault();

  try {
    alert("Processando pedido...");
    await new Promise(r => setTimeout(r, 1000));

    // limpar dados
    ["carrinho", "carrinho_total", "dadosCheckout"].forEach(k => localStorage.removeItem(k));

    alert("Pedido enviado com sucesso! ‚úîÔ∏è");

    const total = parseFloat(localStorage.getItem("totalFinal") || "0.00");
    window.location.href = `/front/web/procesando.html?valor=${total.toFixed(2)}`;
  } catch (erro) {
    console.error(erro);
    alert("Erro ao enviar o pedido.");
  }
}
</script>

<script src="./JS/js14.js"></script>

</body>
</html>
